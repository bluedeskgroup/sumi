rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // Users collection - المستخدمون
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
      allow read: if request.auth != null;
    }
    
    // Products collection - المنتجات  
    match /products/{productId} {
      allow read: if true;
      allow write: if request.auth != null;
    }
    
    // Posts collection - المنشورات
    match /posts/{postId} {
      allow read: if true;
      allow write: if request.auth != null;
    }
    
    // Merchant requests - طلبات التجار
    match /merchant_requests/{requestId} {
      allow read: if request.auth != null;
      allow create: if request.auth != null;
      allow update: if request.auth != null && 
        (request.auth.uid == resource.data.userId || 
         request.auth.token.admin == true);
      allow delete: if request.auth != null && request.auth.token.admin == true;
    }
    
    // Approved merchants - التجار المعتمدون
    match /approved_merchants/{merchantId} {
      allow read: if request.auth != null;
      allow write: if request.auth != null && request.auth.token.admin == true;
    }
    
    // Orders - الطلبات
    match /orders/{orderId} {
      allow read, write: if request.auth != null;
    }
    
    // Invoices - الفواتير
    match /invoices/{invoiceId} {
      allow read, write: if request.auth != null;
    }
    
    // Notifications - الإشعارات
    match /notifications/{notificationId} {
      allow read, write: if request.auth != null && 
        request.auth.uid == resource.data.userId;
    }
    
    // Admin notifications - إشعارات الإدارة
    match /admin_notifications/{notificationId} {
      allow read, write: if request.auth != null && request.auth.token.admin == true;
    }
    
    // Jobs - الوظائف
    match /jobs/{jobId} {
      allow read: if true;
      allow write: if request.auth != null;
    }
    
    // Job applications - طلبات الوظائف
    match /job_applications/{applicationId} {
      allow read, write: if request.auth != null;
    }
    
    // Comments - التعليقات
    match /comments/{commentId} {
      allow read: if true;
      allow write: if request.auth != null;
    }
    
    // Likes - الإعجابات
    match /likes/{likeId} {
      allow read: if true;
      allow write: if request.auth != null;
    }
    
    // Chat messages - رسائل الدردشة
    match /chat_messages/{messageId} {
      allow read, write: if request.auth != null;
    }
    
    // Wallet transactions - معاملات المحفظة
    match /wallet_transactions/{transactionId} {
      allow read, write: if request.auth != null && 
        request.auth.uid == resource.data.userId;
    }
    
    // Cart items - عناصر العربة
    match /cart_items/{cartId} {
      allow read, write: if request.auth != null && 
        request.auth.uid == resource.data.userId;
    }
    
    // Favorites - المفضلة
    match /favorites/{favoriteId} {
      allow read, write: if request.auth != null && 
        request.auth.uid == resource.data.userId;
    }
    
    // Reviews - المراجعات
    match /reviews/{reviewId} {
      allow read: if true;
      allow write: if request.auth != null;
    }
    
    // Categories - الفئات (يمكن للتجار إنشاء فئاتهم الخاصة)
    match /categories/{categoryId} {
      allow read: if true;
      allow write: if request.auth != null;
    }
    
    // Services - الخدمات
    match /services/{serviceId} {
      allow read: if true;
      allow write: if request.auth != null;
    }
    
    // Packages - الباقات
    match /packages/{packageId} {
      allow read: if true;
      allow write: if request.auth != null;
    }
    
    // Admin users - مستخدمو الإدارة
    match /admin_users/{adminId} {
      allow read, write: if request.auth != null && request.auth.token.admin == true;
    }
    
    // System settings - إعدادات النظام
    match /system_settings/{settingId} {
      allow read: if request.auth != null;
      allow write: if request.auth != null && request.auth.token.admin == true;
    }
    
    // Reports - التقارير
    match /reports/{reportId} {
      allow read, write: if request.auth != null;
    }
    
    // Analytics - التحليلات
    match /analytics/{analyticsId} {
      allow read, write: if request.auth != null && request.auth.token.admin == true;
    }
  }
}